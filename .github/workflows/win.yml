name: Build portable builds for Windows

on:
  push:
    tags:
      - "v[0-9]+.[0-9]+.[0-9]"
      - "v[0-9]+.[0-9]"
  workflow_dispatch:

jobs:

  build:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v3
      - uses: ilammy/msvc-dev-cmd@v1
        with:
          toolset: '14.XX'
      
      - name: Setup Python
        uses: actions/setup-python@v4
      
      - name: Install dependencies
        run: |
          pip install pyinstaller
          pip install -r requirements.txt
      
      - name: Build
        run: |
          pyinstaller --noconfirm --onedir --windowed ^
            --name "Textworker" --clean ^
            --add-data "textworker/data;textworker/data" ^
            --add-data "po;textworker/po/" "textworker/__main__.py"
      
      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: TextworkerPortable_Windows
          path: output/
